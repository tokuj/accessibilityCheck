# Implementation Plan

## Tasks

- [ ] 1. 型定義とSSEイベントの拡張
- [ ] 1.1 PageProgressEventの型定義を追加
  - フロントエンドの型定義ファイルに、ページ分析進捗を通知するための新しいSSEイベント型を追加する
  - ページインデックス、総ページ数、URL、タイトル、ステータスの各フィールドを定義する
  - 既存のSSEEvent型のユニオンにPageProgressEventを追加する
  - _Requirements: 5.2_

- [ ] 1.2 (P) AnalysisState型の定義を追加
  - 複数URL分析時の進捗状態を管理するための型を定義する
  - 分析対象URLリスト、現在のページインデックス、完了済みページ、現在のページタイトルを含める
  - _Requirements: 6.1, 6.2_

- [ ] 2. URLチップコンポーネントの作成
- [ ] 2.1 UrlChipコンポーネントを新規作成
  - 単一のURLをチップ形式で表示するプレゼンテーショナルコンポーネントを作成する
  - URLが長い場合は30文字で省略表示し、ツールチップで全体を表示する
  - MUI Chipの削除ボタン（onDelete）を活用し、削除操作を親コンポーネントに通知する
  - リンクアイコンをチップの先頭に表示する
  - _Requirements: 1.1, 1.6_

- [ ] 3. 複数URL入力機能の実装
- [ ] 3.1 UrlInputの状態管理を複数URL対応に拡張
  - 単一URL文字列の状態を、URL配列とテキスト入力の2つの状態に分離する
  - URL追加時にバリデーション（URL形式チェック、重複チェック）を実行する
  - 最大4件の上限を適用し、上限到達時は入力フィールドを無効化する
  - _Requirements: 1.3, 1.4_

- [ ] 3.2 チップ表示とカウンター表示を実装
  - 追加済みのURLをUrlChipコンポーネントで表示する
  - 現在のURL数と最大数を「n/4」形式のカウンターで表示する
  - URLが0件の場合はプレースホルダーテキストを表示する
  - _Requirements: 1.1, 1.2, 1.5, 1.7_

- [ ] 3.3 ドメイン検証機能を実装
  - 2つ目以降のURL追加時に、既存URLとのドメイン（ホスト名）一致を検証する
  - ドメインが異なる場合はエラーメッセージを表示し、追加を拒否する
  - 全URLを削除した場合は、任意のドメインを受け入れ可能にリセットする
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [ ] 3.4 onAnalyzeコールバックのシグネチャ変更
  - コールバックの引数を単一URL文字列からURL配列に変更する
  - 認証設定とセッション情報は既存通り渡す
  - Appコンポーネント側のハンドラーも合わせて更新する
  - _Requirements: 6.3_

- [ ] 4. バックエンドの複数URL分析対応
- [ ] 4.1 SSEハンドラーで複数URLパラメータを解析
  - クエリパラメータから複数URLを配列として取得する処理を追加する
  - URL数の検証（1-4件）を行い、範囲外の場合は400エラーを返す
  - _Requirements: 5.1_

- [ ] 4.2 複数URL順次分析関数の実装
  - 受け取ったURLリストを順番に分析する関数を新規作成する
  - 各URL分析開始時にPageProgressEventを送信する
  - 認証情報（storageState）を全URLで共有して適用する
  - 1URLの分析失敗時も他のURLの分析を継続し、エラー情報を結果に含める
  - _Requirements: 5.2, 5.4, 5.5_

- [ ] 4.3 ページタイトル取得機能の追加
  - 各ページ分析時にdocument.titleを取得してPageResultのnameフィールドに格納する
  - 従来のホスト名ではなくページタイトルを使用するよう変更する
  - _Requirements: 5.6_

- [ ] 4.4 分析結果の集約と完了イベント送信
  - 全URLの分析結果をAccessibilityReportのpages配列に集約する
  - サマリー情報（総違反数、総パス数、総要確認数）を全ページ合計で計算する
  - 完了イベントで集約されたレポートを送信する
  - _Requirements: 5.3_

- [ ] 5. フロントエンドのSSEクライアント拡張
- [ ] 5.1 SSE接続URLの複数URL対応
  - analyzeUrlWithSSE関数で、複数URLをクエリパラメータに設定する処理を追加する
  - 配列形式のパラメータ（urls[]=...&urls[]=...）を構築する
  - _Requirements: 5.1_

- [ ] 5.2 PageProgressEventのハンドリング追加
  - SSEイベント受信処理にPageProgressEventのケースを追加する
  - ページ進捗情報をコールバックで親コンポーネントに通知する
  - _Requirements: 5.2_

- [ ] 6. App状態管理の複数レポート対応
- [ ] 6.1 分析状態の拡張
  - AnalysisState型を使用して、複数URL分析の進捗を追跡する状態を追加する
  - 分析開始時にURLリストを保存し、進捗状態を初期化する
  - SSEのPageProgressEventを受信して、現在のページ情報を更新する
  - _Requirements: 6.1, 6.2, 6.3_

- [ ] 6.2 アクティブタブ状態の追加
  - 現在表示中のレポートページを示すインデックス状態を追加する
  - タブ切り替え時にインデックスを更新するハンドラーを実装する
  - _Requirements: 6.4_

- [ ] 7. 分析中画面の改善
- [ ] 7.1 ページ進捗表示の追加
  - 複数URL分析時に、現在分析中のURLとページタイトルを表示する
  - 全体の進捗（ページ2/4など）を表示する
  - 各ページ内の進捗（axe-core、Pa11y等のステップ）も引き続き表示する
  - _Requirements: 3.1, 3.2_

- [ ] 7.2 固定幅レイアウトの適用
  - 分析中画面のカードに最小幅600pxを設定する
  - ステータステキストの変化でレイアウトが崩れないようにする
  - _Requirements: 3.3_

- [ ] 7.3 完了ページの視覚的区別
  - 完了したページと分析中/未分析のページを視覚的に区別するインジケーターを追加する
  - チェックマークや色分けで完了状態を表現する
  - _Requirements: 3.4_

- [ ] 8. ページタブコンポーネントの作成
- [ ] 8.1 PageTabsコンポーネントを新規作成
  - 複数ページのレポートをタブ形式で切り替えるコンポーネントを作成する
  - 各タブにページタイトルを表示し、長いタイトルは省略表示（ellipsis）する
  - タブに違反数をバッジで表示し、問題の多いページを識別しやすくする
  - タブクリック時にonChangeコールバックでインデックスを通知する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 9. レポート画面のタブ統合
- [ ] 9.1 ReportSummaryにページタブを統合
  - 複数ページ（pages.length > 1）の場合のみ、上部にPageTabsを表示する
  - アクティブなページのレポート内容のみを表示する
  - 単一ページの場合は従来どおりタブなしで表示し、後方互換性を維持する
  - _Requirements: 4.1, 4.6_

- [ ] 9.2 ページ別のスクリーンショットとスコア表示
  - 現在アクティブなページのスクリーンショット、スコア、違反リストを表示する
  - タブ切り替え時に表示内容を更新する
  - _Requirements: 4.4_

- [ ] 10. 統合とエンドツーエンド動作確認
- [ ] 10.1 単一URL分析の後方互換性確認
  - 従来どおり単一URLで分析できることを確認する
  - 認証設定との連携が維持されていることを確認する
  - _Requirements: 4.6_

- [ ] 10.2 複数URL分析のエンドツーエンドテスト
  - 4つのURLを入力し、順次分析が完了することを確認する
  - 分析中画面でページ進捗が正しく表示されることを確認する
  - レポート画面でタブ切り替えが機能することを確認する
  - _Requirements: 1.1, 1.3, 3.1, 3.2, 4.1, 4.4, 5.2, 5.3_

- [ ] 10.3 エラーハンドリングの確認
  - 異なるドメインのURL入力時にエラーが表示されることを確認する
  - 1URLの分析が失敗しても他のURLが継続して分析されることを確認する
  - _Requirements: 2.2, 5.5_
